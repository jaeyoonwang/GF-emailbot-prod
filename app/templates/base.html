<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Email Agent{% endblock %}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.12/htmx.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .htmx-indicator { display: none; }
        .htmx-request .htmx-indicator { display: inline-block; }
        .htmx-request.htmx-indicator { display: inline-block; }
        .tier-1 { border-left: 4px solid #ef4444; }
        .tier-2 { border-left: 4px solid #f97316; }
        .tier-3 { border-left: 4px solid #eab308; }
        .tier-4 { border-left: 4px solid #6b7280; }
        .tier-badge-1 { background-color: #fef2f2; color: #991b1b; }
        .tier-badge-2 { background-color: #fff7ed; color: #9a3412; }
        .tier-badge-3 { background-color: #fefce8; color: #854d0e; }
        .tier-badge-4 { background-color: #f3f4f6; color: #374151; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .spinner { border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        body { background-color: #f9fafb; }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Nav bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <a href="/" class="text-xl font-semibold text-gray-800">ðŸ“§ Email Agent</a>
            </div>
            <div class="flex items-center space-x-4">
                {% if user_name %}
                <span class="text-sm text-gray-600">{{ user_email }}</span>
                <span class="text-sm font-medium text-gray-800">{{ user_name }}</span>
                {% endif %}
                <a href="/auth/logout" class="text-sm text-gray-500 hover:text-red-600 transition">Sign out</a>
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer with request ID -->
    <footer class="bg-white border-t border-gray-200 py-2">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <span class="text-xs text-gray-400">Email Agent v0.1.0</span>
            <span class="text-xs text-gray-400" id="request-id"></span>
        </div>
    </footer>

    <!-- Toast notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Capture request ID from response headers
        document.body.addEventListener('htmx:afterRequest', function(event) {
            var rid = event.detail.xhr.getResponseHeader('X-Request-ID');
            if (rid) {
                document.getElementById('request-id').textContent = 'Request ID: ' + rid;
            }
        });

        // Toast notification helper
        function showToast(message, type) {
            var container = document.getElementById('toast-container');
            var toast = document.createElement('div');
            var colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            toast.className = 'px-4 py-3 rounded-lg text-white text-sm shadow-lg fade-in ' + (colors[type] || colors.info);
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(function() { toast.remove(); }, 4000);
        }

        // Show errors from HTMX responses
        document.body.addEventListener('htmx:responseError', function(event) {
            showToast('Error: ' + (event.detail.xhr.statusText || 'Request failed'), 'error');
        });
    </script>
</body>
</html>